//----------------------------------------------------------------------------//
//---------------------------------|  U  T  |---------------------------------//
//----------------------------------------------------------------------------//
#include "hash/ut_fletcher16.h"
//----------------------------------------------------------------------------//
START_NAMESPACE(ut)
//----------------------------------------------------------------------------//
// Calculates Fletcher checksum
//    @param data - pointer to the data
//    @param size - size of the @data
//    @return - checksum
uint16 Fletcher16Sum(uint8* data, size_t size)
{
	uint16 sum1 = 0xff, sum2 = 0xff;
	size_t tlen;
	while (size)
	{
		tlen = ((size >= 20) ? 20 : size);
		size -= tlen;
		do
		{
			sum2 += sum1 += *data++;
			tlen--;
		} while (tlen);
		sum1 = (sum1& 0xff) + (sum1 >> 8);
		sum2 = (sum2& 0xff) + (sum2 >> 8);
	}
	sum1 = (sum1& 0xff) + (sum1 >> 8);
	sum2 = (sum2& 0xff) + (sum2 >> 8);
	return (sum2 << 8) | sum1;
}

//----------------------------------------------------------------------------//
END_NAMESPACE(ut)
//----------------------------------------------------------------------------//
//----------------------------------------------------------------------------//
//----------------------------------------------------------------------------//
